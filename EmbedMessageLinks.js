(function(swcHelpers,entities,metro,patcher){'use strict';function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);if(e){Object.keys(e).forEach(function(k){if(k!=='default'){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:true,get:function(){return e[k]}});}})}n["default"]=e;return Object.freeze(n)}var swcHelpers__namespace=/*#__PURE__*/_interopNamespace(swcHelpers);function makeEmbed(message,url){var embed={};embed.id=`eml_${message.id}`;embed.type="rich";embed.description=message.content;embed.url=url;embed.author={name:message.author?.username,iconURL:`https://cdn.discordapp.com/avatars/${message.author?.id}/${message.author?.avatar}.png`};embed.color=message.colorString&&parseInt(message.colorString.slice(1),16)||15885656;embed.image=message?.attachments?.find(it=>it.content_type.startsWith("image/")&&it.url)||message?.embeds?.find(it=>it?.image?.url)?.image;embed.fields=message.attachments?.map(it=>{return {name:"",value:`:paperclip: [${it.filename}](${it.url})`,inline:true}});embed.timestamp=message.timestamp;return embed}function makeEmbeds(message){if(!message?.content)return [];var linkRe=/https?:\/\/(?:\w+\.)?discord(?:app)?\.com\/channels\/(\d{17,19}|@me)\/(\d{17,19})\/(\d{17,19})(?!>)/g;var embeds=[];var match;while((match=linkRe.exec(message?.content))!==null){var[url,guild_id,channel_id,id]=match;var msg=metro.MessageStore.getMessage(channel_id,id);if(!msg)continue;embeds.push(makeEmbed(msg,url));}return embeds}var EmbedMessageLinks=function(Plugin1){swcHelpers__namespace.inherits(EmbedMessageLinks,Plugin1);var _super=swcHelpers__namespace.createSuper(EmbedMessageLinks);function EmbedMessageLinks(){swcHelpers__namespace.classCallCheck(this,EmbedMessageLinks);return _super.apply(this,arguments)}var _proto=EmbedMessageLinks.prototype;_proto.start=function start(){return swcHelpers__namespace.asyncToGenerator(function*(){patcher.before(metro.FluxDispatcher,"dispatch",(ctx,event)=>{if(event.type==="MESSAGE_UPDATE"&&event.message){var msgEmbeds=makeEmbeds(event?.message);if(!msgEmbeds)return;event.message.embeds=event.message.embeds?.filter(it=>!it.id||!it.id.startsWith("eml_"))||[];event.message.embeds.push(...msgEmbeds);}else if(event.type==="MESSAGE_CREATE"){var msgEmbeds1=makeEmbeds(event?.message);if(!msgEmbeds1)return;event.message.embeds=event.message.embeds?.filter(it=>!it.id||!it.id.startsWith("eml_"))||[];event.message.embeds.push(...msgEmbeds1);}else if(event.type==="LOAD_MESSAGES_SUCCESS"){event.messages=event?.messages?.map(msg=>{var msgEmbeds=makeEmbeds(event?.message);if(!msgEmbeds)return msg;msg.embeds=msg.embeds?.filter(it=>!it.id||!it.id.startsWith("eml_"))||[];msg.embeds.push(...msgEmbeds);return msg});}});})()};return EmbedMessageLinks}(swcHelpers__namespace.wrapNativeSuper(entities.Plugin));
return EmbedMessageLinks;})(swcHelpers,globalThis._globals.aliucord.entities,globalThis._globals.aliucord.metro,globalThis._globals.aliucord.utils.patcher);